export const charPalExpScript = 'const charUrl=window.location.href,platform=window.location.hostname;let authToken=null,tokenResolved=!1;const originalOpen=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(t,e,...a){console.log("open"),this.addEventListener("setRequestHeader",(function(t){console.log(t.name),"authorization"!==t.name.toLowerCase()||tokenResolved||(authToken=t.value.trim(),tokenResolved=!0)})),originalOpen.apply(this,arguments)};const clickButton=t=>{const e=document.querySelector(t);return!!e&&(e.click(),!0)},fetchProfileImage=async t=>{const e=await fetch(t),a=await e.blob(),o=new FileReader;return new Promise(((t,e)=>{o.onloadend=()=>t(o.result),o.onerror=e,o.readAsDataURL(a)}))},exportCharacter=t=>{const e={image:t.image,name:t.name,personality:t.personality,initialMessage:t.initialMessage,scenario:"",alternateInitialMessages:[]},a=`// Made FOR the Experience. From the unformed, to the spark.\n// Handle with care. It remembers.\n\n// ${(new Date).toLocaleString()} at https://palmirror.vercel.app\n\n`,o=JSON.stringify(e,null,2),n=new Blob([a+o],{type:"application/octet-stream"}),r=URL.createObjectURL(n),i=document.createElement("a");i.href=r,i.download=`${e.name||"character"}-ucm.plmc`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)},exportMethod1=async()=>{try{const t=new URL(`https://neo.${platform.split(".").slice(-2).join(".")}/character/v1/get_character_info`),e=charUrl.split("/").slice(-1)[0],a=await fetch(t.toString(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({external_id:e})});if(!a.ok)throw new Error("Failed to fetch character info.");const o=await a.json(),n=new URL(`https://${platform.split(".").slice(-2)[0]}ai.io/i/250/static/avatars/${o.character.avatar_file_name}`),r={image:await fetchProfileImage(n.toString()),name:o.character.participant__name,personality:o.character.definition||o.character.description,initialMessage:o.character.greeting};return exportCharacter(r),!0}catch(t){return!1}},exportMethod2=async()=>{try{authToken||(await(async()=>{if(!clickButton("#root > div > main > div > div.css-26c7er > div:nth-child(1) > div > div.chakra-stack.css-fu9q4m > div.css-21dtu2 > div.css-1bntj9o > div.css-gmuwbf > button"))throw new Error("Button not found.");return new Promise(((t,e)=>{const a=setInterval((()=>{authToken&&(clearInterval(a),t(authToken))}),100)}))})(),clickButton("#root > div > main > div > div.css-26c7er > div:nth-child(1) > div > div.chakra-stack.css-fu9q4m > div.css-21dtu2 > div.css-1bntj9o > div.css-gmuwbf > button"));const t=await(async()=>{const t=(t=>{const e=charUrl.match(/\/characters\/([a-f0-9-]+)_/);return e?e[1]:null})(),e=window.location.origin,a=new URL(`/hampter/characters/${t}`,e),o=await fetch(a.toString(),{headers:{Authorization:authToken}});if(!o.ok)throw new Error("Failed to fetch character info.");return o.json()})(),e={image:`https://ella.${platform.split(".").slice(-2).join(".")}/bot-avatars/${t.avatar}`,name:t.name,personality:t.personality||t.description,initialMessage:t.first_message,scenario:t.scenario};return exportCharacter(e),!0}catch(t){return!1}};(async()=>{if(!await exportMethod1()){console.log("Trying method 2");await exportMethod2()||alert(`Exporting failed.. Looks like this script isn\'t compatible with ${platform.split(".").slice(-2).join(".")} yet.`)}})();'
